<div class="container">
  <app-sidebar></app-sidebar>
  <app-navbar></app-navbar>
  <div class="page-container">
    <!-- En-tête de la page -->
    <div class="page-header">
      <div>
        <h1 class="page-title">Rapports</h1>
        <p class="page-subtitle">Consultez, générez et exportez vos rapports d'éclairage public</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="exporterTout()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Exporter tout
        </button>
        <button class="btn btn-primary" (click)="genererNouveauRapport()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Générer un rapport
        </button>
      </div>
    </div>

    <!-- Cartes statistiques -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background-color: #f3e8ff;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.total }}</div>
          <div class="stat-label">Total Rapports</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background-color: #d1fae5;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <polyline points="9 11 12 14 22 4"/>
            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.publies }}</div>
          <div class="stat-label">Rapports Publiés</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background-color: #fef3c7;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
            <path d="M12 20h9"/>
            <path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.brouillons }}</div>
          <div class="stat-label">Brouillons</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background-color: #dbeafe;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.cesMois }}</div>
          <div class="stat-label">Ce Mois-ci</div>
        </div>
      </div>
    </div>

    <!-- Section des filtres et liste -->
    <div class="section-card">
      <!-- Filtres -->
      <div class="filters-section">
        <div class="filters-grid">
          <div class="filter-group">
            <label class="filter-label">Rechercher</label>
            <div class="search-input-wrapper">
              <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <input
                type="text"
                class="filter-input search-input"
                placeholder="Rechercher un rapport..."
                [(ngModel)]="searchTerm"
                (input)="onFilterChange()"
              />
            </div>
          </div>

          <div class="filter-group">
            <label class="filter-label">Type de rapport</label>
            <select class="filter-select" [(ngModel)]="selectedType" (change)="onFilterChange()">
              <option value="all">Tous les types</option>
              <option value="performance">Performance</option>
              <option value="maintenance">Maintenance</option>
              <option value="consommation">Consommation</option>
              <option value="pannes">Pannes</option>
              <option value="financier">Financier</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Région</label>
            <select class="filter-select" [(ngModel)]="selectedRegion" (change)="onFilterChange()">
              <option value="all">Toutes les régions</option>
              <option *ngFor="let region of regions" [value]="region">{{ region }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Statut</label>
            <select class="filter-select" [(ngModel)]="selectedStatut" (change)="onFilterChange()">
              <option value="all">Tous les statuts</option>
              <option value="publie">Publié</option>
              <option value="brouillon">Brouillon</option>
              <option value="archive">Archivé</option>
            </select>
          </div>
        </div>

        <div class="results-info">
          <span class="results-count">{{ filteredRapports.length }} rapport(s) trouvé(s)</span>
        </div>
      </div>

      <!-- Liste des rapports -->
      <div class="rapports-grid">
        <div *ngFor="let rapport of filteredRapports" class="rapport-card">
          <div class="rapport-header">
            <div class="rapport-icon">{{ getTypeIcon(rapport.type) }}</div>
            <div class="rapport-badges">
            <span class="type-badge" [ngClass]="getTypeClass(rapport.type)">
              {{ rapport.type }}
            </span>
              <span class="statut-badge" [ngClass]="getStatutClass(rapport.statut)">
              {{ rapport.statut }}
            </span>
            </div>
          </div>

          <div class="rapport-content">
            <h3 class="rapport-title">{{ rapport.titre }}</h3>
            <p class="rapport-description">{{ rapport.description }}</p>

            <div class="rapport-meta">
              <div class="meta-item">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                <span>{{ rapport.periode }}</span>
              </div>
              <div class="meta-item">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                <span>{{ rapport.region }}</span>
              </div>
            </div>

            <div class="rapport-info">
              <div class="info-item">
                <span class="info-label">Auteur:</span>
                <span class="info-value">{{ rapport.auteur }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Généré le:</span>
                <span class="info-value">{{ rapport.dateGeneration }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Taille:</span>
                <span class="info-value">{{ rapport.taille }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Pages:</span>
                <span class="info-value">{{ rapport.nbPages }}</span>
              </div>
            </div>
          </div>

          <div class="rapport-actions">
            <button class="action-btn action-btn-view" (click)="visualiserRapport(rapport)" title="Visualiser">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              Visualiser
            </button>
            <button class="action-btn action-btn-export" (click)="openExportModal(rapport)" title="Exporter">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Exporter
            </button>
            <button class="action-btn-icon action-btn-delete" (click)="supprimerRapport(rapport.id)" title="Supprimer">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Message si aucun rapport -->
        <div *ngIf="filteredRapports.length === 0" class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          <p class="empty-state-text">Aucun rapport trouvé</p>
          <p class="empty-state-subtext">Essayez de modifier vos filtres de recherche</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal d'export -->
  <div class="modal-overlay" *ngIf="showExportModal" (click)="closeExportModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Exporter le rapport</h2>
        <button class="modal-close" (click)="closeExportModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="modal-body" *ngIf="selectedRapportForExport">
        <div class="export-info">
          <p class="export-rapport-name">{{ selectedRapportForExport.titre }}</p>
          <p class="export-rapport-details">{{ selectedRapportForExport.nbPages }} pages • {{ selectedRapportForExport.taille }}</p>
        </div>

        <div class="export-formats">
          <label class="format-label">Choisissez le format d'export :</label>
          <div class="formats-grid">
            <label class="format-option" [class.format-selected]="exportFormat === 'pdf'">
              <input type="radio" name="format" value="pdf" [(ngModel)]="exportFormat" />
              <div class="format-card">
                <div class="format-icon">📄</div>
                <div class="format-name">PDF</div>
                <div class="format-description">Document portable</div>
              </div>
            </label>

            <label class="format-option" [class.format-selected]="exportFormat === 'excel'">
              <input type="radio" name="format" value="excel" [(ngModel)]="exportFormat" />
              <div class="format-card">
                <div class="format-icon">📊</div>
                <div class="format-name">Excel</div>
                <div class="format-description">Feuille de calcul</div>
              </div>
            </label>

            <label class="format-option" [class.format-selected]="exportFormat === 'word'">
              <input type="radio" name="format" value="word" [(ngModel)]="exportFormat" />
              <div class="format-card">
                <div class="format-icon">📝</div>
                <div class="format-name">Word</div>
                <div class="format-description">Document éditable</div>
              </div>
            </label>

            <label class="format-option" [class.format-selected]="exportFormat === 'csv'">
              <input type="radio" name="format" value="csv" [(ngModel)]="exportFormat" />
              <div class="format-card">
                <div class="format-icon">📋</div>
                <div class="format-name">CSV</div>
                <div class="format-description">Données tabulaires</div>
              </div>
            </label>

            <label class="format-option" [class.format-selected]="exportFormat === 'json'">
              <input type="radio" name="format" value="json" [(ngModel)]="exportFormat" />
              <div class="format-card">
                <div class="format-icon">🔧</div>
                <div class="format-name">JSON</div>
                <div class="format-description">Format structuré</div>
              </div>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeExportModal()">Annuler</button>
        <button class="btn btn-primary" (click)="exportRapport()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Exporter
        </button>
      </div>
    </div>
  </div>

</div>
