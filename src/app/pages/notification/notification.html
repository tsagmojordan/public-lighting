<div class="container">
  <app-sidebar></app-sidebar>
  <app-navbar></app-navbar>
  <div class="page-container">
    <!-- En-tête de la page -->
    <div class="page-header">
      <div>
        <h1 class="page-title">Notifications</h1>
        <p class="page-subtitle">Gérez et suivez toutes les alertes et notifications du système</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="supprimerLues()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
          Supprimer les lues
        </button>
        <button class="btn btn-primary" (click)="marquerToutCommeLu()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
            <path d="M22 4L12 14.01l-3-3"/>
          </svg>
          Tout marquer comme lu
        </button>
      </div>
    </div>

    <!-- Cartes statistiques -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background-color: #dbeafe;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 01-3.46 0"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ totalNotifications }}</div>
          <div class="stat-label">Total Notifications</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background-color: #fee2e2;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ urgentes }}</div>
          <div class="stat-label">Notifications Urgentes</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background-color: #f3e8ff;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <circle cx="18" cy="8" r="3" fill="#7c3aed"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ nonLues }}</div>
          <div class="stat-label">Non Lues</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background-color: #d1fae5;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ aujourdhui }}</div>
          <div class="stat-label">Aujourd'hui</div>
        </div>
      </div>
    </div>

    <!-- Section des filtres et liste -->
    <div class="section-card">
      <!-- Filtres -->
      <div class="filters-section">
        <div class="filters-grid">
          <div class="filter-group">
            <label class="filter-label">Rechercher</label>
            <div class="search-input-wrapper">
              <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <input
                type="text"
                class="filter-input search-input"
                placeholder="Rechercher une notification..."
                [(ngModel)]="searchTerm"
                (input)="onFilterChange()"
              />
            </div>
          </div>

          <div class="filter-group">
            <label class="filter-label">Type</label>
            <select class="filter-select" [(ngModel)]="selectedType" (change)="onFilterChange()">
              <option value="all">Tous les types</option>
              <option value="urgente">Urgente</option>
              <option value="maintenance">Maintenance</option>
              <option value="info">Information</option>
              <option value="systeme">Système</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Priorité</label>
            <select class="filter-select" [(ngModel)]="selectedPriorite" (change)="onFilterChange()">
              <option value="all">Toutes priorités</option>
              <option value="haute">Haute</option>
              <option value="moyenne">Moyenne</option>
              <option value="basse">Basse</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Statut</label>
            <select class="filter-select" [(ngModel)]="selectedStatut" (change)="onFilterChange()">
              <option value="all">Tous les statuts</option>
              <option value="nonlues">Non lues</option>
              <option value="lues">Lues</option>
            </select>
          </div>
        </div>

        <div class="results-info">
          <span class="results-count">{{ filteredNotifications.length }} notification(s) trouvée(s)</span>
        </div>
      </div>

      <!-- Liste des notifications -->
      <div class="notifications-list">
        <div
          *ngFor="let notification of filteredNotifications"
          class="notification-card"
          [class.notification-non-lue]="!notification.lue"
        >
          <div class="notification-indicator" [class.indicator-active]="!notification.lue"></div>

          <div class="notification-main">
            <div class="notification-header">
              <div class="notification-header-left">
                <span class="notification-emoji">{{ getTypeIcon(notification.type) }}</span>
                <div>
                  <h3 class="notification-title">{{ notification.titre }}</h3>
                  <div class="notification-meta">
                    <span class="notification-time">{{ notification.date }} à {{ notification.heure }}</span>
                    <span class="meta-separator">•</span>
                    <span class="notification-region">{{ notification.region }}</span>
                  </div>
                </div>
              </div>
              <div class="notification-badges">
              <span class="type-badge" [ngClass]="getTypeClass(notification.type)">
                {{ notification.type }}
              </span>
                <span class="priorite-badge" [ngClass]="getPrioriteClass(notification.priorite)">
                {{ notification.priorite }}
              </span>
              </div>
            </div>

            <p class="notification-message">{{ notification.message }}</p>

            <div class="notification-footer">
              <div class="notification-location">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                <span>{{ notification.localisation }}</span>
              </div>

              <div class="notification-actions">
                <button
                  *ngIf="!notification.lue"
                  class="action-btn"
                  (click)="marquerCommeLue(notification)"
                  title="Marquer comme lue"
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <path d="M22 4L12 14.01l-3-3"/>
                  </svg>
                </button>
                <button
                  *ngIf="notification.lue"
                  class="action-btn"
                  (click)="marquerCommeNonLue(notification)"
                  title="Marquer comme non lue"
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                  </svg>
                </button>
                <button
                  class="action-btn action-btn-view"
                  title="Voir les détails"
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
                <button
                  class="action-btn action-btn-delete"
                  (click)="supprimerNotification(notification.id)"
                  title="Supprimer"
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                  </svg>
                </button>
              </div>
            </div>

            <div class="notification-lampid" *ngIf="notification.lampadaireId">
              <span class="lampid-label">ID Lampadaire:</span>
              <span class="lampid-value">{{ notification.lampadaireId }}</span>
            </div>
          </div>
        </div>

        <!-- Message si aucune notification -->
        <div *ngIf="filteredNotifications.length === 0" class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 01-3.46 0"/>
          </svg>
          <p class="empty-state-text">Aucune notification trouvée</p>
          <p class="empty-state-subtext">Essayez de modifier vos filtres de recherche</p>
        </div>
      </div>
    </div>
  </div>

</div>
